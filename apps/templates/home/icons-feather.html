{% extends "layouts/base.html" %}

{% block title %}HR Burnout Monitor{% endblock %}

{% block stylesheets %}
<style>
  .kpi-card { min-height: 120px; }
  .risk-low { background: #e8f5e9; }
  .risk-med { background: #fff8e1; }
  .risk-high { background: #ffebee; }
  .sparkline { height: 40px; }
  .avatar { width: 28px; height: 28px; border-radius: 999px; object-fit: cover; }
  .table-sticky thead th { position: sticky; top: 0; background: #fff; z-index: 2; }
</style>
{% endblock stylesheets %}

{% block content %}
<main class="content">
  <div class="container-fluid p-0">

    <div class="d-flex align-items-center justify-content-between mb-3">
      <h1 class="h3 mb-0"><i class="align-middle mr-2" data-feather="activity"></i> HR Burnout Monitor</h1>
    </div>

    <!-- KPIs -->
    <div class="row">
      <div class="col-sm-6 col-lg-3 mb-3">
        <div class="card kpi-card shadow-sm">
          <div class="card-body d-flex align-items-center">
            <div class="mr-3"><i class="align-middle" data-feather="thermometer"></i></div>
            <div>
              <div class="text-muted small">Org Burnout Risk</div>
              <div class="h3 mb-0">0.72</div>
              <small class="text-muted">+5% vs last 30d</small>
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-6 col-lg-3 mb-3">
        <div class="card kpi-card shadow-sm">
          <div class="card-body d-flex align-items-center">
            <div class="mr-3"><i class="align-middle" data-feather="user-check"></i></div>
            <div>
              <div class="text-muted small">Attendance Rate</div>
              <div class="h3 mb-0">91%</div>
              <small class="text-muted">-2% vs last 30d</small>
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-6 col-lg-3 mb-3">
        <div class="card kpi-card shadow-sm">
          <div class="card-body d-flex align-items-center">
            <div class="mr-3"><i class="align-middle" data-feather="clock"></i></div>
            <div>
              <div class="text-muted small">Avg. Lates / Person / wk</div>
              <div class="h3 mb-0">2.5</div>
              <small class="text-muted">+0.4 vs last 30d</small>
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-6 col-lg-3 mb-3">
        <div class="card kpi-card shadow-sm">
          <div class="card-body d-flex align-items-center">
            <div class="mr-3"><i class="align-middle" data-feather="smile"></i></div>
            <div>
              <div class="text-muted small">Mood (Pos / Neu / Neg)</div>
              <div class="h3 mb-0">58 / 27 / 15</div>
              <small class="text-muted">from login/logout FR system</small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-8 mb-3">
        <div class="card shadow-sm">
          <div class="card-header d-flex justify-content-between align-items-center">
            <div>
              <h3 class="card-title mb-0">Attendance & Lates Trend</h3>
              <div class="card-subtitle text-muted">Daily attendance %, late check-ins</div>
            </div>
          </div>
          <div class="card-body">
            <canvas id="trendChart" height="120"></canvas>
          </div>
        </div>
      </div>

      <div class="col-lg-4 mb-3">
        <div class="card shadow-sm">
          <div class="card-header">
            <h3 class="card-title mb-0">Mood Distribution</h3>
            <div class="card-subtitle text-muted">From facial recognition during logins/logouts</div>
          </div>
          <div class="card-body">
            <canvas id="moodChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-6 mb-3">
        <div class="card shadow-sm">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h3 class="card-title mb-0">Login/Logout Span vs. Mood</h3>
            <div class="small text-muted">Each dot = person-day</div>
          </div>
          <div class="card-body">
            <canvas id="scatterChart" height="140"></canvas>
          </div>
        </div>
      </div>

      <div class="col-lg-6 mb-3">
        <div class="card shadow-sm table-sticky">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h3 class="card-title mb-0">People At Risk</h3>
            <div class="small text-muted">Computed risk ≥ 0.6</div>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive" style="max-height: 360px;">
              <table class="table table-hover mb-0">
                <thead>
                  <tr>
                    <th>Employee</th>
                    <th>Team</th>
                    <th>Absence %</th>
                    <th>Lates/wk</th>
                    <th>Neg. Mood %</th>
                    <th>Risk</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="risk-high">
                    <td><img class="avatar mr-2" src="https://i.pravatar.cc/48?img=1"> Alex Santos</td>
                    <td>Web</td>
                    <td>9%</td>
                    <td>2.3</td>
                    <td>18%</td>
                    <td><strong>0.72</strong></td>
                  </tr>
                  <tr class="risk-med">
                    <td><img class="avatar mr-2" src="https://i.pravatar.cc/48?img=2"> Bianca Cruz</td>
                    <td>Android</td>
                    <td>6%</td>
                    <td>3.8</td>
                    <td>22%</td>
                    <td><strong>0.65</strong></td>
                  </tr>
                  <tr class="risk-med">
                    <td><img class="avatar mr-2" src="https://i.pravatar.cc/48?img=3"> Carlo Dizon</td>
                    <td>Data</td>
                    <td>12%</td>
                    <td>2.9</td>
                    <td>25%</td>
                    <td><strong>0.63</strong></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</main>
{% endblock content %}

{% block javascripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
feather.replace();

// Hardcoded chart data
const dailyLabels = Array.from({length: 30}, (_,i)=>`Day ${i+1}`);
const attendance = [88, 85, 90, 87, 92, 89, 93, 91, 90, 88, 86, 89, 92, 90, 91, 87, 88, 89, 90, 92, 93, 91, 88, 89, 90, 87, 85, 89, 90, 91];
const lateCounts = [10, 14, 9, 13, 11, 15, 12, 10, 11, 13, 12, 14, 9, 10, 12, 13, 11, 15, 14, 10, 12, 11, 13, 14, 15, 12, 10, 9, 11, 13];

new Chart(document.getElementById('trendChart'), {
  type: 'line',
  data: {
    labels: dailyLabels,
    datasets: [
      { label: 'Attendance %', data: attendance, tension: .35, borderWidth: 2, yAxisID: 'y1' },
      { label: 'Late Count', data: lateCounts, type:'bar', borderWidth: 1, yAxisID: 'y2' }
    ]
  },
  options: {
    responsive: true,
    scales: {
      y1: { type: 'linear', position: 'left', min: 0, max: 100 },
      y2: { type: 'linear', position: 'right', grid: { drawOnChartArea: false } }
    }
  }
});

new Chart(document.getElementById('moodChart'), {
  type: 'doughnut',
  data: {
    labels: ['Positive','Neutral','Negative'],
    datasets: [{ data: [58, 27, 15] }]
  },
  options: { plugins: { legend: { position: 'bottom' } } }
});

new Chart(document.getElementById('scatterChart'), {
  type: 'scatter',
  data: {
    datasets: [{
      label: 'Span vs Mood',
      data: [
        {x: 9.2, y: 0.4, name: 'Alex'},
        {x: 10.1, y: -0.2, name: 'Bianca'},
        {x: 8.7, y: 0.1, name: 'Carlo'},
        {x: 9.5, y: 0.6, name: 'Diane'},
        {x: 10.4, y: -0.3, name: 'Eli'},
        {x: 9.8, y: 0.2, name: 'Faye'}
      ]
    }]
  },
  options: {
    plugins: { tooltip: { callbacks: { label: (ctx)=> `${ctx.raw.name}: ${ctx.raw.x}h, mood ${ctx.raw.y}` } } },
    scales: {
      x: { title: { display: true, text: 'Login → Logout span (hours)' }, min: 6, max: 14 },
      y: { title: { display: true, text: 'Mood score (-1..1)' }, min: -1, max: 1 }
    }
  }
});
</script>
{% endblock javascripts %}
